(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1929],{880:function(e,t,s){Promise.resolve().then(s.bind(s,9730))},9730:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return k}});var a=s(7437),o=s(2265);let l=(0,o.createContext)({userInput:"",setUserInput:()=>{},chatMessages:[],setChatMessages:()=>{},chatFileItems:[],setChatFileItems:()=>{},isGenerating:!1,setIsGenerating:()=>{},chatFiles:[],setChatFiles:()=>{},chatImages:[],setChatImages:()=>{},newMessageFiles:[],setNewMessageFiles:()=>{},newMessageImages:[],setNewMessageImages:()=>{},showFilesDisplay:!1,setShowFilesDisplay:()=>{}}),r=e=>{let{children:t}=e,[s,r]=(0,o.useState)(""),[n,i]=(0,o.useState)([]),[c,u]=(0,o.useState)([]),[d,m]=(0,o.useState)(!1),[h,p]=(0,o.useState)([]),[f,g]=(0,o.useState)([]),[x,y]=(0,o.useState)([]),[b,v]=(0,o.useState)([]),[w,C]=(0,o.useState)(!1);return(0,a.jsx)(l.Provider,{value:{userInput:s,setUserInput:r,chatMessages:n,setChatMessages:i,chatFileItems:c,setChatFileItems:u,isGenerating:d,setIsGenerating:m,chatFiles:h,setChatFiles:p,chatImages:f,setChatImages:g,newMessageFiles:x,setNewMessageFiles:y,newMessageImages:b,setNewMessageImages:v,showFilesDisplay:w,setShowFilesDisplay:C},children:t})},n=()=>(0,o.useContext)(l);var i=s(920);let c=["Enter up to three questions that guide your familyâ€™s decision making.","What are your family values?","What is a statement or commitment that your family lives by?","What statement defines your family's vision?","What is your family's impact statement?"],u=()=>{let{chatMessages:e,setChatMessages:t}=(0,o.useContext)(l),[s,a]=(0,o.useState)(0),[r,n]=(0,o.useState)(!1),[u,d]=(0,o.useState)(!1),m=(0,o.useCallback)((e,t)=>({id:(0,i.Z)(),type:t,message:e}),[]),h=(0,o.useCallback)(e=>{t(t=>[...t,e])},[t]),p=(0,o.useCallback)(()=>{s<c.length?(h(m(c[s],"bot")),a(e=>e+1)):(h(m("You may type exit to finish creating your charter.","bot")),d(!0))},[h,m,s]),f=(0,o.useCallback)(async()=>{let t=e.filter(e=>"user"===e.type).map(e=>e.message);try{let e=await fetch("http://localhost:8000/api/chat/submit_responses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({responses:t}),credentials:"include"});if(!e.ok)throw Error("HTTP error ".concat(e.status));let s=await e.json();console.log("Responses submitted successfully:",s)}catch(e){console.error("Failed to submit responses:",e)}},[e]),g=(0,o.useCallback)(async e=>{try{let t=await fetch("http://localhost:8000/api/chat/send_message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e}),credentials:"include"});if(!t.ok)throw Error("HTTP error ".concat(t.status));let{answer:s}=await t.json();return s}catch(e){return console.error("Error during fetch or parsing:",e),"Sorry, there was an error processing your message."}},[]);return{chatMessages:e,handleSendMessage:(0,o.useCallback)(async e=>{n(!0);let o=e.trim().toLowerCase();try{if(h(m(e,"user")),"start"===o&&0===s)p();else if("exit"===o&&u)await f(),t([]),a(0),d(!1),h(m("Thank you, I have recorded your responses. Goodbye!","bot"));else if(s>0&&s<=c.length)p();else if(u||0===s){let t=await g(e);h(m(t,"bot"))}else h(m("Please type 'start' to begin the questionnaire, or ask anything else.","bot"))}finally{n(!1)}},[h,p,m,s,t,f,g,u]),handleNewChat:(0,o.useCallback)(()=>{t([]),a(0),d(!1)},[t]),isGenerating:r}},d=()=>{let{isGenerating:e,chatMessages:t}=(0,o.useContext)(l),s=(0,o.useRef)(null),a=(0,o.useRef)(null),r=(0,o.useRef)(!1),[n,i]=(0,o.useState)(!1),[c,u]=(0,o.useState)(!0),[d,m]=(0,o.useState)(!1),[h,p]=(0,o.useState)(!1);(0,o.useEffect)(()=>{m(!1),!e&&d&&m(!1)},[e,d]);let f=(0,o.useCallback)(e=>{let t=e.target,s=Math.round(t.scrollHeight)-Math.round(t.scrollTop)===Math.round(t.clientHeight);u(s),i(0===t.scrollTop),s||r.current?m(!1):m(!0),p(t.scrollHeight>t.clientHeight)},[]),g=(0,o.useCallback)(()=>{s.current&&s.current.scrollIntoView({behavior:"instant"})},[]),x=(0,o.useCallback)(()=>{r.current=!0,setTimeout(()=>{a.current&&a.current.scrollIntoView({behavior:"instant"}),r.current=!1},100)},[]);return(0,o.useEffect)(()=>{e&&!d&&x()},[t,e,d,x]),{messagesStartRef:s,messagesEndRef:a,isAtTop:n,isAtBottom:c,userScrolled:d,isOverflowing:h,handleScroll:f,scrollToTop:g,scrollToBottom:x,setIsAtBottom:u}};var m=s(89),h=s(1442),p=s(648),f=s(3849),g=s(8953);let x=()=>{let{t:e}=(0,m.$G)(),{handleSendMessage:t,isGenerating:s}=u(),[l,r]=(0,o.useState)(""),n=(0,o.useRef)(null);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex flex-col flex-wrap justify-center gap-2"}),(0,a.jsxs)("div",{className:"border-input relative mt-3 flex min-h-[60px] w-full items-center justify-center rounded-xl border-2",children:[(0,a.jsx)(p.Z,{className:"absolute bottom-[12px] left-3 cursor-pointer p-1 hover:opacity-50",size:32,onClick:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.click()}}),(0,a.jsx)("input",{ref:n,className:"hidden",type:"file",onChange:e=>{console.log(e.target.files)}}),(0,a.jsx)(h.Z,{className:"ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring text-md flex w-full resize-none rounded-md border-none bg-transparent px-14 py-2 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",placeholder:e("Type start to begin creating your family charter..."),onChange:e=>{r(e.target.value)},value:l,minRows:1,maxRows:5,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||""===l.trim()||(e.preventDefault(),t(l),r(""))}}),(0,a.jsx)("div",{className:"absolute bottom-[14px] right-3 cursor-pointer hover:opacity-50",children:s?(0,a.jsx)(f.Z,{className:"hover:bg-background animate-pulse rounded bg-transparent p-1",size:30}):(0,a.jsx)(g.Z,{className:"bg-primary text-secondary rounded p-1 ".concat(!l&&"cursor-not-allowed opacity-50"),onClick:()=>{l&&(t(l),r(""))},size:30})})]})]})};s(1810);let y=()=>{let{chatMessages:e}=n(),t=(0,o.useRef)(null);return(0,o.useEffect)(()=>{var s;null===(s=t.current)||void 0===s||s.scrollIntoView({behavior:"smooth"}),console.log("Updated messages:",e)},[e]),(0,a.jsx)("div",{className:"chat-container",children:e.map((e,t)=>(0,a.jsx)("div",{className:"message ".concat("bot"===e.type?"bot-message":"user-message"),children:(0,a.jsx)("div",{className:"".concat(e.type,"-text"),children:e.message})},e.id||t))})};var b=s(2012),v=s(8969);let w=e=>{let{isAtTop:t,isAtBottom:s,isOverflowing:o,scrollToTop:l,scrollToBottom:r}=e;return(0,a.jsxs)(a.Fragment,{children:[!t&&o&&(0,a.jsx)(b.Z,{className:"cursor-pointer opacity-50 hover:opacity-100",size:32,onClick:l}),!s&&o&&(0,a.jsx)(v.Z,{className:"cursor-pointer opacity-50 hover:opacity-100",size:32,onClick:r})]})},C=()=>{let{handleNewChat:e}=u();console.log("ChatUI Component Rendering");let{messagesStartRef:t,messagesEndRef:s,handleScroll:l,scrollToBottom:r,isAtTop:i,isAtBottom:c,isOverflowing:m,scrollToTop:h}=d();(0,o.useEffect)(()=>{console.log("ChatUI mounted, initializing chat session..."),e()},[e]);let{chatMessages:p}=n();return(0,o.useEffect)(()=>{console.log("Chat messages in consumer updated:",p)},[p]),(0,a.jsxs)("div",{className:"relative flex h-full flex-col items-center",children:[(0,a.jsx)("div",{className:"absolute left-4 top-2.5 flex justify-center",children:(0,a.jsx)(w,{isAtTop:i,isAtBottom:c,isOverflowing:m,scrollToTop:h,scrollToBottom:r})}),(0,a.jsx)("div",{className:"absolute right-4 top-1 flex h-[40px] items-center space-x-2"}),(0,a.jsx)("div",{className:"bg-secondary flex max-h-[50px] min-h-[50px] w-full items-center justify-left border-b-2 font-bold p-6",children:(0,a.jsx)("div",{className:"max-w-[200px] truncate sm:max-w-[400px] md:max-w-[500px] lg:max-w-[600px] xl:max-w-[700px] text-3xl",children:"Videre Chatbot"})}),(0,a.jsxs)("div",{className:"flex size-full flex-col overflow-auto border-b",onScroll:l,children:[(0,a.jsx)("div",{ref:t}),(0,a.jsx)(y,{}),(0,a.jsx)("div",{ref:s})]}),(0,a.jsx)("div",{className:"relative w-full min-w-[300px] items-end px-2 pb-3 pt-0 sm:w-[600px] sm:pb-8 sm:pt-5 md:w-[700px] lg:w-[700px] xl:w-[800px]",children:(0,a.jsx)(x,{})}),(0,a.jsx)("div",{className:"absolute bottom-2 right-2 hidden md:block lg:bottom-4 lg:right-4"})]})};var j=(e,t)=>{(0,o.useEffect)(()=>{let s=s=>{s.metaKey&&s.shiftKey&&s.key===e&&(s.preventDefault(),t())};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[e,t])};function k(){let{chatMessages:e}=(0,o.useContext)(l),{handleNewChat:t}=u(),[s,n]=(0,o.useState)(!1);return j("o",t),(0,o.useEffect)(()=>{var t,a,o;console.log("Chat messages changed:",e.map(e=>e.message));let l=null!==(o=null===(a=e[e.length-1])||void 0===a?void 0:null===(t=a.message)||void 0===t?void 0:t.toLowerCase())&&void 0!==o?o:"";console.log("Last message text:",l),s||"start"!==l||(console.log("Start conditions met. Starting chat."),n(!0))},[e,s]),console.log("Rendering ChatPage, Chat Started:",s),(0,a.jsx)(r,{children:(0,a.jsx)(C,{})})}},1810:function(){}},function(e){e.O(0,[3113,4666,2971,7023,1744],function(){return e(e.s=880)}),_N_E=e.O()}]);