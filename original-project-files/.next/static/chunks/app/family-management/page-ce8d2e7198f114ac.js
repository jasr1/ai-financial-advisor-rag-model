(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9838],{855:function(e,t,r){Promise.resolve().then(r.bind(r,8124)),Promise.resolve().then(r.bind(r,12)),Promise.resolve().then(r.bind(r,9973))},5400:function(e,t,r){"use strict";r.d(t,{$I:function(){return c},$p:function(){return a},S:function(){return l},Yk:function(){return i},fe:function(){return s},o4:function(){return d}}),r(4590);var n=r(8064),s=(0,n.$)("d2fce7739bab52a457a5593aa5c8934939f6ffc9"),a=(0,n.$)("170886bb4e74b05f7c02751c1aab47957616ffde"),i=(0,n.$)("25dd229b000ad658317ea8c095eec1e47e8009c9"),l=(0,n.$)("4b8df60b8e8135fe48db88c9465915e21211584c"),c=(0,n.$)("4d8b56da50684cd9a95564dd39d5217fa433b627"),d=(0,n.$)("b3232be302b9027a387eb0910bf015724c648364")},8124:function(e,t,r){"use strict";r.d(t,{default:function(){return k}});var n=r(7437),s=r(2265),a=r(2157),i=r(5400),l=r(3274),c=r(883),d=r(9913),o=r(9733),u=r(7583),m=r.n(u),f=e=>{let{member:t,onRemove:r}=e,[a,d]=(0,s.useState)(!1),u=async()=>{d(!0),await (0,i.fe)(t.id),d(!1),r()};return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:t.name}),(0,n.jsx)("td",{children:t.title}),(0,n.jsx)("td",{children:t.email}),(0,n.jsx)("td",{children:t.phone}),(0,n.jsx)("td",{children:(0,n.jsx)(o.z,{variant:"destructive",disabled:a,onClick:u,children:a?(0,n.jsx)(l.Z,{className:"animate-spin",size:24,children:(0,n.jsx)("title",{className:"sr-only",children:"Delete"})}):(0,n.jsx)(c.Z,{size:24,children:(0,n.jsx)("title",{className:"sr-only",children:"Delete"})})})})]})};let x=(0,s.forwardRef)((e,t)=>{let{familyId:r}=e,[a,l]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),o=async()=>{try{let e=await (0,i.$I)(r);l(e)}catch(e){e instanceof Error?d(e.message):d("Unexpected error occurred")}};return((0,s.useEffect)(()=>{r&&o()},[r]),(0,s.useImperativeHandle)(t,()=>({reloadMembers:o})),c)?(0,n.jsx)("div",{children:c}):(0,n.jsx)("div",{className:"prose mt-8",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Name"}),(0,n.jsx)("th",{children:"Title"}),(0,n.jsx)("th",{children:"Email"}),(0,n.jsx)("th",{children:"Phone"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:a.length>0?a.map(e=>(0,n.jsx)(f,{member:e,onRemove:o},e.email)):(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:5,className:"text-center",children:"You have no family members yet."})})})]})})});function h(){return(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(l.Z,{className:"animate-spin"}),(0,n.jsx)("span",{className:"mt-4 text-center text-xl",children:"Loading..."})]})})}x.displayName="FamilyMembers";var j=r(9343),b=r(9772),p=r(1014),y=r(3363),v=r(7209),g=r(6046);let N=b.z.object({email:b.z.string().email({message:"Invalid email"}),family_id:b.z.number()});function w(e){let{familyId:t,onSuccess:r}=e,[a,l]=(0,s.useState)(!1),c=(0,j.cI)({resolver:(0,p.F)(N),defaultValues:{email:"",family_id:t}});async function d(e){l(!0);try{await (0,i.o4)(e),c.reset(),r()}catch(e){console.error("Unexpected error:",e)}finally{l(!1)}}return(0,n.jsx)(y.l0,{...c,children:(0,n.jsxs)("form",{onSubmit:c.handleSubmit(d),className:"mt-4 space-y-8",children:[(0,n.jsx)(y.Wi,{control:c.control,name:"email",render:e=>{let{field:t}=e;return(0,n.jsxs)(y.xJ,{children:[(0,n.jsx)(y.lX,{children:"Add a new family member:"}),(0,n.jsx)(y.NI,{children:(0,n.jsx)(v.I,{placeholder:"Enter user email here",type:"email",...t})}),(0,n.jsx)(y.zG,{})]})}}),(0,n.jsx)(g.Z,{defaultText:"Add Family Member",loadingText:"Adding...",disabled:a})]})})}var S=r(9973);let I=b.z.object({name:b.z.string().nonempty({message:"Family name cannot be empty"})});function z(e){let{family:t,onSuccess:r}=e,[a,l]=(0,s.useState)(!1),c=(0,j.cI)({resolver:(0,p.F)(I),defaultValues:{name:t.name}});async function d(e){l(!0);try{await (0,i.S)(t.id,e),r({id:t.id,name:e.name})}catch(e){console.error("Unexpected error:",e)}finally{l(!1)}}return(0,s.useEffect)(()=>{c.reset({name:t.name})},[t,c]),(0,n.jsx)(y.l0,{...c,children:(0,n.jsxs)("form",{onSubmit:c.handleSubmit(d),className:"mt-4 space-y-8",children:[(0,n.jsx)(y.Wi,{control:c.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(y.xJ,{children:[(0,n.jsx)(y.lX,{children:"Edit family name:"}),(0,n.jsx)(y.NI,{children:(0,n.jsx)(v.I,{placeholder:"Enter family name",type:"text",...t})}),(0,n.jsx)(y.zG,{})]})}}),(0,n.jsx)(g.Z,{defaultText:"Save",loadingText:"Saving...",disabled:a})]})})}var F=e=>{let{isOpen:t,onRequestClose:r,family:a,onSave:i}=e,l=(0,s.useRef)(null);return(0,s.useEffect)(()=>{"undefined"!=typeof document&&m().setAppElement(document.body)},[]),(0,n.jsx)(m(),{isOpen:t,onRequestClose:r,contentLabel:"Edit Family",className:"fixed inset-0 flex items-center justify-center p-4",overlayClassName:"fixed inset-0 bg-black bg-opacity-75",children:(0,n.jsxs)("div",{className:"relative bg-white rounded-lg max-w-3xl w-full max-h-full overflow-hidden",children:[(0,n.jsx)("button",{onClick:r,className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700","aria-label":"Close",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-6 w-6",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,n.jsxs)("div",{className:"overflow-auto max-h-[calc(100vh-50px)] p-6",children:[(0,n.jsxs)("h1",{className:"text-3xl font-bold",children:[null==a?void 0:a.name," Family"]}),a&&(0,n.jsx)(s.Suspense,{fallback:(0,n.jsx)(h,{}),children:(0,n.jsx)(x,{ref:l,familyId:a.id})}),a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.Separator,{className:"mx-auto mt-2 w-[100%]"}),(0,n.jsx)(w,{familyId:a.id,onSuccess:()=>{l.current&&l.current.reloadMembers()}}),(0,n.jsx)(z,{family:a,onSuccess:e=>{i(e),r()}})]})]})]})})},E=e=>{let{family:t}=e,[r,a]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),[f,x]=(0,s.useState)(t),h=async()=>{a(!0),await (0,i.Yk)(f.id),a(!1)};return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"text-left",children:f.name}),(0,n.jsxs)("td",{className:"text-center",children:[(0,n.jsx)(o.z,{variant:"destructive",disabled:r,onClick:h,className:"mr-2",children:r?(0,n.jsx)(l.Z,{className:"animate-spin",size:24,children:(0,n.jsx)("title",{className:"sr-only",children:"Delete"})}):(0,n.jsx)(c.Z,{size:24,children:(0,n.jsx)("title",{className:"sr-only",children:"Delete"})})}),(0,n.jsx)(o.z,{variant:"default",onClick:()=>{m(!0)},children:(0,n.jsx)(d.Z,{size:24,children:(0,n.jsx)("title",{className:"sr-only",children:"Edit"})})}),(0,n.jsx)(F,{isOpen:u,onRequestClose:()=>{m(!1)},family:f,onSave:e=>{x(e),m(!1)}})]})]})},k=()=>{let[e,t]=(0,s.useState)([]),[r,i]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{var e;let r=(0,a.e)(),{data:n,error:s}=await r.auth.getUser();if(s){i(s.message);return}let{data:l,error:c}=await r.from("families").select("*").eq("admin_id",null===(e=n.user)||void 0===e?void 0:e.id);c?i(c.message):t(l||[])})()},[]),r)?(0,n.jsx)("div",{children:r}):(0,n.jsx)("div",{className:"prose mt-8",children:(0,n.jsxs)("table",{className:"w-full table-auto",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"w-auto text-left",children:"Name"}),(0,n.jsx)("th",{className:"w-1/4 text-center",children:"Actions"})]})}),(0,n.jsx)("tbody",{children:e.length>0?e.map(e=>(0,n.jsx)(E,{family:e},e.id)):(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:2,className:"text-center",children:"You have no families yet."})})})]})})}},12:function(e,t,r){"use strict";r.d(t,{FamilyForm:function(){return f}});var n=r(7437),s=r(2265),a=r(9343),i=r(9772),l=r(1014),c=r(5400),d=r(3363),o=r(7209),u=r(6046);let m=i.z.object({name:i.z.string({message:"Invalid email"})});function f(){let[e,t]=(0,s.useState)(!1),r=(0,a.cI)({resolver:(0,l.F)(m),defaultValues:{name:""}});async function i(e){t(!0),await (0,c.$p)(e),r.reset(),t(!1)}return(0,n.jsx)(d.l0,{...r,children:(0,n.jsxs)("form",{onSubmit:r.handleSubmit(i),className:"mt-4 space-y-8",children:[(0,n.jsx)(d.Wi,{control:r.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(d.xJ,{children:[(0,n.jsx)(d.lX,{children:"Create new family:"}),(0,n.jsx)(d.NI,{children:(0,n.jsx)(o.I,{placeholder:"Enter new family name here",type:"name",...t})}),(0,n.jsx)(d.zG,{})]})}}),(0,n.jsx)(u.Z,{defaultText:"Add family",loadingText:"Adding...",disabled:e})]})})}},6046:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(7437),s=r(9733),a=r(3274);function i(e){let{loadingText:t="Submitting...",defaultText:r="Submit",...i}=e;return(0,n.jsx)(s.z,{...i,size:"lg",className:"w-full",type:"submit",disabled:i.disabled,children:i.disabled?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Z,{className:"mr-2 h-6 w-6 animate-spin"}),(0,n.jsx)("span",{children:t})]}):(0,n.jsx)("span",{children:r})})}},9733:function(e,t,r){"use strict";r.d(t,{d:function(){return c},z:function(){return d}});var n=r(7437),s=r(2265),a=r(1538),i=r(2218),l=r(9354);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",chatbot:"bg-green-500 text-white hover:bg-green-600"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:d=!1,...o}=e,u=d?a.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(c({variant:s,size:i,className:r})),ref:t,...o})});d.displayName="Button"},3363:function(e,t,r){"use strict";r.d(t,{NI:function(){return j},Wi:function(){return u},l0:function(){return d},lX:function(){return h},xJ:function(){return x},zG:function(){return b}});var n=r(7437),s=r(2265),a=r(1538),i=r(9343),l=r(9354),c=r(402);let d=i.RV,o=s.createContext({}),u=e=>{let{...t}=e;return(0,n.jsx)(o.Provider,{value:{name:t.name},children:(0,n.jsx)(i.Qr,{...t})})},m=()=>{let e=s.useContext(o),t=s.useContext(f),{getFieldState:r,formState:n}=(0,i.Gc)(),a=r(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=t;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...a}},f=s.createContext({}),x=s.forwardRef((e,t)=>{let{className:r,...a}=e,i=s.useId();return(0,n.jsx)(f.Provider,{value:{id:i},children:(0,n.jsx)("div",{ref:t,className:(0,l.cn)("space-y-2",r),...a})})});x.displayName="FormItem";let h=s.forwardRef((e,t)=>{let{className:r,...s}=e,{error:a,formItemId:i}=m();return(0,n.jsx)(c._,{ref:t,className:(0,l.cn)(a&&"text-destructive",r),htmlFor:i,...s})});h.displayName="FormLabel";let j=s.forwardRef((e,t)=>{let{...r}=e,{error:s,formItemId:i,formDescriptionId:l,formMessageId:c}=m();return(0,n.jsx)(a.g7,{ref:t,id:i,"aria-describedby":s?"".concat(l," ").concat(c):"".concat(l),"aria-invalid":!!s,...r})});j.displayName="FormControl",s.forwardRef((e,t)=>{let{className:r,...s}=e,{formDescriptionId:a}=m();return(0,n.jsx)("p",{ref:t,id:a,className:(0,l.cn)("text-sm text-muted-foreground",r),...s})}).displayName="FormDescription";let b=s.forwardRef((e,t)=>{let{className:r,children:s,...a}=e,{error:i,formMessageId:c}=m(),d=i?String(null==i?void 0:i.message):s;return d?(0,n.jsx)("p",{ref:t,id:c,className:(0,l.cn)("text-sm font-medium text-destructive",r),...a,children:d}):null});b.displayName="FormMessage"},7209:function(e,t,r){"use strict";r.d(t,{I:function(){return i}});var n=r(7437),s=r(2265),a=r(9354);let i=s.forwardRef((e,t)=>{let{className:r,type:s,...i}=e;return(0,n.jsx)("input",{type:s,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...i})});i.displayName="Input"},402:function(e,t,r){"use strict";r.d(t,{_:function(){return d}});var n=r(7437),s=r(2265),a=r(8364),i=r(2218),l=r(9354);let c=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.f,{ref:t,className:(0,l.cn)(c(),r),...s})});d.displayName=a.f.displayName},9973:function(e,t,r){"use strict";r.d(t,{Separator:function(){return l}});var n=r(7437),s=r(2265),a=r(8484),i=r(9354);let l=s.forwardRef((e,t)=>{let{className:r,orientation:s="horizontal",decorative:l=!0,...c}=e;return(0,n.jsx)(a.f,{ref:t,decorative:l,orientation:s,className:(0,i.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",r),...c})});l.displayName=a.f.displayName},2157:function(e,t,r){"use strict";r.d(t,{e:function(){return a}});var n=r(959),s=r(357);function a(){return(0,n.AY)(s.env.NEXT_PUBLIC_SUPABASE_URL,s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},9354:function(e,t,r){"use strict";r.d(t,{Y:function(){return c},cn:function(){return i},e:function(){return l}});var n=r(4839),s=r(6164),a=r(2157);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}let l=Intl.NumberFormat("en-CA",{currency:"CAD",currencyDisplay:"symbol",currencySign:"standard",style:"currency",minimumFractionDigits:2,maximumFractionDigits:2});async function c(){let e=(0,a.e)(),{data:{user:t}}=await e.auth.getUser();if(t){let{data:r,error:n}=await e.from("profiles").select("role").eq("user_id",t.id).single();return n?(console.error("Error fetching user profile:",n.message),{role:null}):{role:r.role}}return{role:null}}}},function(e){e.O(0,[8034,7158,6910,2971,7023,1744],function(){return e(e.s=855)}),_N_E=e.O()}]);